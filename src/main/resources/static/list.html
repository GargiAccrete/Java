<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student List</title>
    <link rel="stylesheet" type="text/css" href="CSS/list.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>

    <h1>Student List</h1>

    <table>
        <thead>
            <tr>
                <th>Sr No.</th>
                <th>First Name</th>
                <th>Middle Name</th>
                <th>Last Name</th>
                <th>Gender</th>
                <th>Email</th>
                <th>Mobile Number</th>
                <th>Institute Type</th>
                <th>Institute</th>
                <th>Department</th>
                <th>Designation</th>
                <th>Hobbies</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="studentTableBody"></tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            function fetchStudents() {
                $.ajax({
                    type: 'GET',
                    url: '/student/listStudents',
                    success: function (data) {
                        $('#studentTableBody').empty();
                        $.each(data, function (index, student) {
                            var row = `<tr data-student-id="${student.id}">
                                <td>${index + 1}</td>
                                <td>${student.f_name}</td>
                                <td>${student.m_name}</td>
                                <td>${student.l_name}</td>
                                <td>${student.is_male ? 'Male' : 'Female'}</td>
                                <td>${student.email}</td>
                                <td>${student.mobile_no}</td>
                                <td>${student.institute_type_id == 1 ? 'Type 1' : 'Type 2'}</td>
                                <td>${student.institute_id == 1 ? 'Institute 1' : 'Institute 2'}</td>
                                <td>${student.department_id == 1 ? 'Department 1' : 'Department 2'}</td>
                                <td>${student.designation_id == 1 ? 'Designation 1' : 'Designation 2'}</td>
                                <td>${student.hobbies}</td>
                                <td>
                                    <a href="#" onclick="editStudent(${student.id})"><i class="fas fa-edit"></i></a>
                                    <a href="#" onclick="deleteStudent(${student.id})"><i class="fas fa-trash-alt"></i></a>
                                </td>
                            </tr>`;
                            $('#studentTableBody').append(row);
                        });
                    },
                    error: function (e) {
                        console.log('Error fetching data:', e);
                        alert('An error occurred while fetching data. Please try again.');
                    }
                });
            }

            window.editStudent = function (studentId) {
                window.location.href = `/index.html?studentId=${studentId}`;
            };

            window.deleteStudent = function (studentId) {
                $.ajax({
                    type: 'GET',
                    url: `/student/deleteStudent/${studentId}`,
                    success: function (data) {
                        $('#studentTableBody').find(`tr[data-student-id="${studentId}"]`).remove();
                        updateSrNumbers();
                        alert('Student deleted successfully.');
                    },
                    error: function (e) {
                        console.log('Error deleting student:', e);
                        alert('An error occurred while deleting the student. Please try again.');
                    }
                });
            };

            function updateSrNumbers() {
                $('#studentTableBody tr').each(function (index) {
                    $(this).find('td:first').text(index + 1);
                });
            }

            fetchStudents();
        });
    </script>

</body>

</html>
